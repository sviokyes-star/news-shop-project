# CS2 Map Time Limit Plugin

Плагин для Counter-Strike 2, устанавливающий лимит времени карты на 30 минут (настраивается).

## Возможности

- ✅ Автоматически устанавливает время карты на 30 минут
- ✅ Настраиваемое время через команды
- ✅ Предупреждения за 5 минут и 1 минуту до смены
- ✅ Команда для проверки оставшегося времени
- ✅ Возможность продлить карту
- ✅ Принудительная смена карты
- ✅ Автоматическая смена по истечении времени

## Команды

### Для всех игроков:

| Команда | Описание |
|---------|----------|
| `css_timeleft` | Показать оставшееся время карты |

### Для администраторов (@css/root):

| Команда | Описание | Использование |
|---------|----------|---------------|
| `css_timelimit` | Установить лимит времени | `css_timelimit <минуты>` |
| `css_extendmap` | Продлить карту | `css_extendmap <минуты>` |
| `css_nextmap` | Сменить карту | `css_nextmap [название]` |

## Установка

1. Соберите плагин:
   ```bash
   build.bat
   ```

2. Скопируйте файл `bin/Release/net8.0/MapTimeLimitPlugin.dll` в папку:
   ```
   game/csgo/addons/counterstrikesharp/plugins/MapTimeLimitPlugin/
   ```

3. Перезапустите сервер или выполните:
   ```
   css_plugins reload
   ```

## Примеры использования

### Узнать оставшееся время:
```
css_timeleft
```
Вывод: `Осталось времени: 15:30`

### Установить время карты на 45 минут (админ):
```
css_timelimit 45
```
Устанавливает новый лимит времени.

### Продлить карту на 10 минут (админ):
```
css_extendmap 10
```
Добавляет 10 минут к текущему лимиту.

### Отключить лимит времени (админ):
```
css_timelimit 0
```
Карта будет длиться бесконечно.

### Сменить карту немедленно (админ):
```
css_nextmap
```
Смена на следующую карту из ротации через 5 секунд.

### Сменить на конкретную карту (админ):
```
css_nextmap de_dust2
```
Мгновенная загрузка указанной карты.

## Как работает

### При загрузке плагина:
1. Устанавливает `mp_timelimit` на 30 минут
2. Запоминает время старта карты
3. Запускает таймер проверки каждые 10 секунд

### Во время игры:
1. **За 5 минут до конца:**
   - Выводит предупреждение в чат всем игрокам
   
2. **За 1 минуту до конца:**
   - Выводит финальное предупреждение красным цветом

3. **По истечении времени:**
   - Объявляет о смене карты
   - Через 3 секунды автоматически меняет карту

### Команды администратора:
- Можно в любой момент изменить лимит
- Можно продлить текущую карту
- Можно принудительно сменить карту

## Уведомления в чате

Плагин отправляет следующие уведомления:

```
[Map Time] Осталось 5 минут до смены карты!       (желтый текст)
[Map Time] Осталась 1 минута до смены карты!      (красный текст)
[Map Time] Время истекло! Смена карты...          (красный текст)
[Map Time] Карта продлена на 10 минут             (при продлении)
[Map Time] Лимит времени карты: 45 минут          (при изменении)
```

## Настройки по умолчанию

- **Время карты:** 30 минут
- **Предупреждения:** за 5 минут и 1 минуту
- **Проверка времени:** каждые 10 секунд
- **Задержка смены:** 3 секунды после истечения

## Технические детали

### Используемые ConVars:
- `mp_timelimit` — устанавливает лимит времени карты (в минутах)

### Система предупреждений:
- Первое предупреждение: 5 минут
- Финальное предупреждение: 1 минута
- Автоматическая смена: 0 секунд

### Точность:
- Проверка каждые 10 секунд
- Отображение времени с точностью до секунды

## Применение

Идеально подходит для:
- **Public серверов** — фиксированное время карты
- **Community серверов** — регулярная смена карт
- **Practice серверов** — ограниченные сессии
- **Турниров** — контроль времени матчей
- **Casual режимов** — динамичная ротация

## Совместимость

Плагин совместим с:
- ✅ Плагинами голосования за карты
- ✅ Системами ротации карт
- ✅ RTV (Rock The Vote) плагинами
- ✅ Модами геймплея

## Логи сервера

Плагин записывает в консоль:
```
[Map Time Limit] Плагин загружен!
[Map Time Limit] Время карты установлено: 30 минут
[Map Time Limit] mp_timelimit установлен на 30 минут
[Map Time Limit] Лимит времени достигнут, смена карты
[Map Time Limit] Карта продлена на 10 минут (всего: 40)
```

## Отличия от стандартного mp_timelimit

| Функция | Стандартный mp_timelimit | Этот плагин |
|---------|-------------------------|-------------|
| Автоустановка | Нет | Да (30 мин) |
| Предупреждения | Нет | Да (5 мин, 1 мин) |
| Проверка времени | Команда | Автоматически |
| Продление карты | Нет | Да |
| Отображение | Нет | В чат |

## Требования

- CounterStrikeSharp
- .NET 8.0
- Права администратора (@css/root) для управления временем

## Дополнительные функции

### Голосование за продление (будущая версия):
Планируется добавить автоматическое голосование за продление карты за 2 минуты до конца.

### Статистика карт (будущая версия):
Отслеживание, сколько раз играли каждую карту.
